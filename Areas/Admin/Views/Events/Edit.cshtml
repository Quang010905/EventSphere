@model EventSphere.Models.entities.TblEvent
@{
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
}

<h2 class="mb-4">Sửa sự kiện</h2>

<div class="mb-3">
    <label class="form-label">Tiêu đề</label>
    <input type="text" id="Title" class="form-control" value="@Model.Title" />
</div>

<div class="mb-3">
    <label class="form-label">Mô tả</label>
    <textarea id="Description" class="form-control" rows="4">@Model.Description</textarea>
</div>

<div class="mb-3">
    <label class="form-label">Địa điểm</label>
    <input type="text" id="Venue" class="form-control" value="@Model.Venue" />
</div>

<div class="mb-3">
    <label class="form-label">Thể loại</label>
    <input type="text" id="Category" class="form-control" value="@Model.Category" />
</div>

<div class="mb-3">
    <label class="form-label">Người tổ chức</label>
    <select id="OrganizerId" class="form-select">
        <option value="">-- Chọn người tổ chức --</option>
        @foreach (var u in ViewBag.Organizers)
        {
            <option value="@u.Id" @(Model.OrganizerId == u.Id ? "selected" : "")>@u.Email</option>
        }
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Trạng thái</label>
    <select id="Status" class="form-select">
        <option value="0" @(Model.Status == 0 ? "selected" : "")>Chưa duyệt</option>
        <option value="1" @(Model.Status == 1 ? "selected" : "")>Đã duyệt</option>
        <option value="2" @(Model.Status == 2 ? "selected" : "")>Đã vô hiệu</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Ảnh hiện tại</label><br />
    @if (!string.IsNullOrEmpty(Model.Image))
    {
        <img src="~/uploads/@Model.Image" class="img-thumbnail" style="max-width:300px;" />
    }
    else
    {
        <span>Chưa có ảnh</span>
    }
</div>

<div class="mb-3">
    <label class="form-label">Thay ảnh mới</label>
    <input type="file" id="ImageFile" class="form-control" />
</div>

<div class="d-flex gap-2">
    <button type="button" class="btn btn-primary" onclick="saveEvent()">Lưu thay đổi</button>
    <a href="@Url.Action("Index", "Events", new { area = "Admin" })" class="btn btn-secondary">Hủy</a>

</div>

<script>
     function saveEvent() {
        var formData = new FormData();
        formData.append("Id", @Model.Id);
        formData.append("Title", document.getElementById("Title").value);
        formData.append("Description", document.getElementById("Description").value);
        formData.append("Venue", document.getElementById("Venue").value);
        formData.append("Category", document.getElementById("Category").value);
        formData.append("Status", document.getElementById("Status").value);
        formData.append("OrganizerId", document.getElementById("OrganizerId").value);

        var imageFile = document.getElementById("ImageFile").files[0];
        if(imageFile) formData.append("imageFile", imageFile);

        fetch('@Url.Action("EditAjax", "Events", new { area = "Admin" })', {
            method: 'POST',
            body: formData
        })
        .then(res => res.json())
        .then(data => {
            if(data.success){
                alert("Cập nhật thành công!");
                window.location.href = '@Url.Action("Index", "Events", new { area = "Admin" })';
            } else {
                alert("Lỗi: " + data.message);
            }
        })
        .catch(err => console.error(err));
    }

</script>
