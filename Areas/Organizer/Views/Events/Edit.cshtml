@model EventSphere.Models.entities.TblEvent
@{
    Layout = "~/Areas/Organizer/Views/Shared/_LayoutOrganizer.cshtml";
}

<h2 class="mb-4">Edit Event</h2>

<div class="mb-3">
    <label class="form-label">Title</label>
    <input type="text" id="Title" class="form-control" value="@Model.Title" />
</div>

<div class="mb-3">
    <label class="form-label">Description</label>
    <textarea id="Description" class="form-control" rows="4">@Model.Description</textarea>
</div>

<div class="mb-3">
    <label class="form-label">Venue</label>
    <input type="text" id="Venue" class="form-control" value="@Model.Venue" />
</div>

<div class="mb-3">
    <label class="form-label">Category</label>
    <input type="text" id="Category" class="form-control" value="@Model.Category" />
</div>

<div class="mb-3">
    <label class="form-label">Organizer</label>
    <select id="OrganizerId" class="form-select">
        <option value="">-- Select Organizer --</option>
        @foreach (var u in ViewBag.Organizers)
        {
            <option value="@u.Id" @(Model.OrganizerId == u.Id ? "selected" : "")>@u.Email</option>
        }
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Date</label>
    <input type="date" id="Date" class="form-control"
           value="@(Model.Date.HasValue ? Model.Date.Value.ToString("yyyy-MM-dd") : "")" />
</div>

<div class="mb-3">
    <label class="form-label">Time</label>
    <input type="time" id="Time" class="form-control"
           value="@(Model.Time.HasValue ? Model.Time.Value.ToString("HH\\:mm") : "")" />
</div>

<div class="mb-3">
    <label class="form-label">Status</label>
    <select id="Status" class="form-select">
        <option value="0" @(Model.Status == 0 ? "selected" : "")>Pending</option>
        <option value="1" @(Model.Status == 1 ? "selected" : "")>Accepted</option>
        <option value="2" @(Model.Status == 2 ? "selected" : "")>Denied</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Image</label><br />
    @if (!string.IsNullOrEmpty(Model.Image))
    {
        <img src="~/uploads/@Model.Image" class="img-thumbnail" style="max-width:300px;" />
    }
    else
    {
        <span>No Image</span>
    }
</div>

<div class="mb-3">
    <label class="form-label">Update new image</label>
    <input type="file" id="ImageFile" class="form-control" />
</div>

<div class="d-flex gap-2">
    <button type="button" class="btn btn-primary" onclick="saveEvent()">Save</button>
    <a href="@Url.Action("Index", "Events", new { area = "Organizer" })" class="btn btn-secondary">Cancel</a>
</div>

<script>
    function saveEvent() {
        var formData = new FormData();
        formData.append("Id", @Model.Id);
        formData.append("Title", document.getElementById("Title").value);
        formData.append("Description", document.getElementById("Description").value);
        formData.append("Venue", document.getElementById("Venue").value);
        formData.append("Category", document.getElementById("Category").value);
        formData.append("Status", document.getElementById("Status").value);
        formData.append("OrganizerId", document.getElementById("OrganizerId").value);
        formData.append("Date", document.getElementById("Date").value);
        formData.append("Time", document.getElementById("Time").value);

        var imageFile = document.getElementById("ImageFile").files[0];
        if (imageFile) formData.append("imageFile", imageFile);

        fetch('@Url.Action("EditAjax", "Events", new { area = "Organizer" })', {
            method: 'POST',
            body: formData
        })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert("Update Success!");
                    window.location.href = '@Url.Action("Index", "Events", new { area = "Organizer" })';
                } else {
                    alert("Error: " + data.message);
                }
            })
            .catch(err => console.error(err));
    }
</script>
