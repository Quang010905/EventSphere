@{
    Layout = "/Areas/Client/Views/Shared/_LayoutClient.cshtml";
    var stuId = Context.Session.GetInt32("UId");
    var eve = ViewBag.itemEvent as EventSphere.Models.ModelViews.EventView;
}

@if (eve != null)
{
    <div class="ms-all-content ms-all-content-space">
        <main>
            <!-- page title area start  -->
            <section class="page-title-area page-title-spacing p-relative zindex-1"
                     data-background="assets/img/bg/work-bg.jpg">
                <div class="ms-overlay ms-overlay9 p-absolute zindex--1"></div>
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-xxl-11">
                            <h3 class="ms-page-title text-center">
                                We are a group of artists, musicians producers, DJ's, inventors, engineers, activists,
                            </h3>
                        </div>
                    </div>
                </div>
            </section>
            <section class="ms-event-details-area pt-130 pb-70">
                <div class="container">
                    <div class="row">
                        <div class="col-xl-8 col-lg-12">
                            <div class="ms-event-details-content mb-40">
                                <div class="ms-event-dimg m-img d-inline-block fix ms-br-15 mb-30">
                                    <img src="@Url.Content("~/uploads/" + eve.Image)"
                                         alt="event image"
                                         style="width:1296px; height:532px; object-fit:cover; border-radius:15px;" />
                                </div>

                                <span class="ms-event-ddate d-inline-block mb-30">@eve.Date</span>
                                <div class="ms-border2 pb-20 mb-30">
                                    <h2 class="ms-event-dtitle">
                                        @eve.Title
                                    </h2>
                                </div>
                                <p class="mb-25">
                                    @eve.Description
                                </p>
                            </div>
                        </div>
                        <div class="col-xl-4 col-lg-8">
                            <div class="ms-event-sidebar mb-60">
                                <h3 class="ms-event-sidebar-title">@eve.Title</h3>
                                <div class="ms-event-sidebar-item">
                                    <div class="ms-event-sidebar-inner">
                                        <h4 class="ms-event-title2">Event Start Date</h4>
                                        <span class="ms-event-stext">@eve.Date @eve.Time</span>
                                    </div>
                                    <div class="ms-event-sidebar-inner">
                                        <h4 class="ms-event-title2">Event Category</h4>
                                        <span class="ms-event-stext">@eve.Category</span>
                                    </div>
                                </div>
                                <div class="ms-event-sidebar-item">
                                    <div class="ms-event-sidebar-inner">
                                        <h4 class="ms-event-title2">Email</h4>
                                        <span class="ms-event-stext">@eve.OrganizerEmail</span>
                                    </div>
                                </div>
                                <div class="ms-event-sidebar-item">
                                    <div class="ms-event-sidebar-inner">
                                        <h4 class="ms-event-title2">Organizer</h4>
                                        <span class="ms-event-stext">@eve.OrganizerName</span>
                                    </div>
                                </div>
                                <div class="ms-event-sidebar-item">
                                    <div class="ms-event-sidebar-inner">
                                        <h4 class="ms-event-title2">Venue</h4>
                                        <span class="ms-event-stext">@eve.Venue</span>
                                    </div>
                                </div>
                                <div class="mt-4 d-flex flex-column gap-2">
                                    @if (TempData["ErrorMessage"] != null)
                                    {
                                        <div class="alert alert-danger">
                                            @TempData["ErrorMessage"]
                                        </div>
                                    }
                                    else if (TempData["SuccessMessage"] != null)
                                    {
                                        <div class="alert alert-success">
                                            @TempData["SuccessMessage"]
                                        </div>
                                    }

                                    @{
                                        bool isExpired = false;

                                        if (eve.Date.HasValue && eve.Time.HasValue)
                                        {
                                            var eventDateTime = eve.Date.Value.ToDateTime(eve.Time.Value);
                                            isExpired = eventDateTime < DateTime.Now;
                                        }
                                        else
                                        {
                                            isExpired = true;
                                        }
                                    }

                                    @if (ViewBag.AlreadyRegistered == true)
                                    {
                                        <form action="@Url.Action("RegisterEvent", "EventDetail", new { area = "Client" })" method="post">
                                            <input type="hidden" name="eventId" value="@eve.Id" />
                                            <button class="unfill__btn d-block w-100" type="submit" @(isExpired ? "disabled=\"disabled\"" : "")>
                                                Register
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form action="@Url.Action("RegisterEvent", "EventDetail", new { area = "Client" })" method="post">
                                            <input type="hidden" name="eventId" value="@eve.Id" />
                                            <button class="unfill__btn d-block w-100" type="submit" @(isExpired ? "disabled=\"disabled\"" : "")>
                                                Register
                                            </button>
                                        </form>
                                    }

                                    <div class="ms-submit-btn mb-40">
                                        <a href="@Url.Action("Index", "Home")"
                                           class="unfill__btn d-block w-100 d-flex align-items-center justify-content-center">
                                            Back to Home
                                        </a>
                                    </div>

                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </section>
        </main>
    </div>
}
else
{
    <div class="alert alert-warning text-center">No events found.</div>
}
