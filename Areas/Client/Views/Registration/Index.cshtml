@{
    Layout = "~/Areas/Client/Views/Shared/_LayoutClient.cshtml";
}

<!-- Hiển thị thông báo -->
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<h5 style="visibility: hidden;">Event Detail</h5>


<div class="mb-3">
    <form method="get" asp-action="Index" asp-controller="Registration" class="form-inline">
        <input type="hidden" name="id" value="@ViewBag.StudentId" />
        <label class="me-2 fw-bold">Lọc theo trạng thái:</label>
        <select name="status" class="form-select form-select-sm w-auto d-inline-block"
                onchange="this.form.submit()">
            <option value="" @(ViewBag.StatusFilter == null ? "selected" : "")>Tất cả</option>
            <option value="0" @(ViewBag.StatusFilter == 0 ? "selected" : "")>Pending</option>
            <option value="1" @(ViewBag.StatusFilter == 1 ? "selected" : "")>Accepted</option>
            <option value="2" @(ViewBag.StatusFilter == 2 ? "selected" : "")>Denied</option>
            <option value="3" @(ViewBag.StatusFilter == 3 ? "selected" : "")>Đã hủy</option>
        </select>
    </form>
</div>




@if (ViewBag.itemReg != null)
{
    var ls = (List<EventSphere.Models.ModelViews.RegistrationView>)ViewBag.itemReg;
    if (ls != null && ls.Count > 0)
    {
        <div class="row g-4">
            @foreach (var item in ls)
            {
                <div class="col-12 col-md-6 col-lg-4">
                    <article class="card h-100 border-0 shadow-sm rounded-3">
                        <div class="overflow-hidden rounded-top">
                            <img src="@Url.Content("~/uploads/" + item.EventImage)"
                                 class="w-100"
                                 style="height:200px; object-fit:cover;"
                                 alt="@item.EventName" />
                        </div>
                        <div class="card-body d-flex flex-column p-3">
                            <h5 class="card-title mb-1 text-truncate" title="@item.EventName">
                                @item.EventName
                            </h5>
                            <p class="text-muted mb-2">
                                <i class="bi bi-calendar-event me-1"></i> Ngày: @item.EventDate?.ToString("dd/MM/yyyy")
                                <span> • <i class="bi bi-clock"></i> Giờ: @item.EventTime</span>
                            </p>
                            <p class="text-muted mb-3">
                                <i class="bi bi-geo-alt me-1"></i> Địa điểm: @item.Venue
                            </p>

                            <!-- Trạng thái -->
                            <p class="fw-bold mb-3">
                                @if (item.Status == 0)
                                {
                                    <span class="badge bg-warning text-dark">Pending</span>
                                }
                                else if (item.Status == 1)
                                {
                                    <span class="badge bg-success">Accepted</span>
                                }
                                else if (item.Status == 2)
                                {
                                    <span class="badge bg-danger">Denied</span>
                                }
                                else if (item.Status == 3)
                                {
                                    <span class="badge bg-secondary">Đã hủy</span>
                                }
                            </p>

                            <!-- Nút hành động -->
                            <div class="d-flex justify-content-between mt-auto">
                                <a href="@Url.Action("Index", "EventDetail", new { id = item.EventId, area = "Client" })"
                                   class="btn btn-sm btn-primary">
                                    Chi tiết
                                </a>

                                @if (item.Status != 3) // chưa hủy thì mới cho hủy
                                {
                                    <form asp-action="Cancel" asp-controller="Registration" method="post" class="d-inline">
                                        <input type="hidden" name="stuId" value="@item.StudentId" />
                                        <input type="hidden" name="eventId" value="@item.EventId" />
                                        <button type="submit" class="btn btn-sm btn-outline-danger"
                                                onclick="return confirm('Bạn có chắc muốn hủy đăng ký không?');">
                                            Hủy đăng ký
                                        </button>
                                    </form>
                                }
                            </div>
                        </div>
                    </article>
                </div>
            }
        </div>
    }
}
